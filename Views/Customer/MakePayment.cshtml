@{
    ViewData["Title"] = "Make a Payment";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<style>
    .card {
        border-radius: 20px;
        padding: 2rem;
    }

    .booking-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .payment-amount {
        font-size: 2.5rem;
        font-weight: bold;
        color: #28a745;
    }
</style>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <h3 class="text-center mb-4"><i class="fa-solid fa-money-bill-wave"></i> Make a Payment</h3>

                <!-- Display pending bookings with prices -->
                <div class="mb-4">
                    <h5 class="mb-3"><i class="fa fa-list-check me-2"></i>Your Pending Payments</h5>

                    @if (ViewBag.PendingBookings != null && ViewBag.PendingBookings.Count > 0)
                    {
                        foreach (var booking in ViewBag.PendingBookings)
                        {
                            <div class="booking-card">
                                <div class="row align-items-center">
                                    <div class="col-8">
                                        <h6>@booking.ServiceType Cleaning</h6>
                                        <small>
                                            <i class="fa fa-calendar me-1"></i>@booking.BookingDate.ToString("dd MMM yyyy")
                                            | <i class="fa fa-clock me-1"></i>@booking.TimeSlot
                                        </small>
                                        <br>
                                        <small><i class="fa fa-location-dot me-1"></i>@booking.Address</small>
                                    </div>
                                    <div class="col-4 text-end">
                                        <div class="payment-amount">R@(booking.FinalPrice.ToString("F2"))</div>
                                        <form method="post" asp-controller="Customer" asp-action="MakePayment">
                                            <input type="hidden" name="bookingId" value="@booking.BookingId" />
                                            <input type="hidden" name="amount" value="@booking.FinalPrice" />
                                            <input type="hidden" name="serviceType" value="@booking.ServiceType" />
                                            <button type="submit" class="btn btn-light btn-sm mt-2">
                                                <i class="fa fa-credit-card me-1"></i>Pay Now
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="alert alert-info text-center">
                            <i class="fa fa-info-circle me-2"></i>No pending payments found.
                        </div>
                    }
                </div>

                <!-- Manual Payment Form (for other payments) -->
                <div class="border-top pt-4">
                    <h5 class="mb-3"><i class="fa fa-credit-card me-2"></i>Other Payment</h5>

                    @if (ViewBag.PaymentSuccess != null)
                    {
                        <div class="alert alert-success text-center">
                            ✅ Payment of <strong>R@(ViewBag.Amount?.ToString("F2") ?? "0.00")</strong> received. Thank you!
                        </div>
                    }

                    <form method="post" asp-controller="Customer" asp-action="MakePayment">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Service Description</label>
                            <input type="text" name="description" class="form-control" placeholder="What is this payment for?" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">R</span>
                                <input type="number" name="amount" class="form-control" placeholder="Enter Amount" step="0.01" min="1" required />
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Payment Method</label>
                            <select name="paymentMethod" class="form-select" required>
                                <option value="">Select Payment Method</option>
                                <option value="Cash">Cash</option>
                                <option value="EFT">EFT</option>
                                <option value="Card">Card</option>
                                <option value="Mobile Money">Mobile Money</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Reference/Note</label>
                            <input type="text" name="reference" class="form-control" placeholder="Payment reference or note (optional)" />
                        </div>

                        <button type="submit" class="btn btn-success w-100 btn-lg">
                            <i class="fa fa-check-circle me-2"></i> Confirm Payment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>